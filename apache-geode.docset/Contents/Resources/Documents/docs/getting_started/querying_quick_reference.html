<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Geode Querying FAQ and Examples |
    Geode Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
</head>

<body class="docs docs_getting_started docs_getting_started_querying_quick_reference">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "apache.org";
    </script>

    <!--  -->

    <div class="container">

      <!--googleoff: index-->
      <!--  -->
      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        <!--  -->
        <!--   <h1 class="title-container">
    Geode Querying FAQ and Examples
  </h1>
 -->
          <div id="js-quick-links" >
            
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<p>This topic answers some frequently asked questions on querying functionality. It provides examples to help you get started with Geode querying.</p>

<p><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_AFAD97A4BA2D45CF91ED1525A54DDFD6"></a>
For additional information on Geode querying, see <a href="../developing/querying_basics/chapter_overview.html">Querying</a>.</p>

<ul>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_7A4D2C6A4E2C4F4384C158FFCA9CA1C0">How do I write and execute a query against a Geode region?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_641D97CD874D4182961C85429ACA1B05">Can I see query string examples, listed by query type?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_5383407F9D004D4EB4E695252EBA1EF0">Which APIs should I use to write my queries?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_3E6E4B33D57846008EF4404D2B687597">How do I invoke an object&rsquo;s method in a query?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_9221C29BC1FD49D7BBD26BB34D5BDEB8">Can I invoke a static method on an object in a query?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_907DBBBA1AEC4570A15B3491B0A7DF0E">How do I write a reusable query?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_3A9528E8E43140BAA0D5A1457CCAB2D2">When should I create indexes to use in my queries?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_76CDCCFBDB134A339DBE556C28D48F11">How do I create an index?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_EDD17817450C4FC0B510CD87DB2FCD16">Can I query a partitioned region? Can I perform a join query on a partitioned region?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_5FF905E0D10D4CDF9E6F49A70848AF69">How can I improve the performance of a partitioned region query?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_FBC59A5420FD40D6907A302A1D50DF7E">Which query language elements are supported in Geode?</a></li>
<li>  <a href="querying_quick_reference.html#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_314B88A55B514B88A12DC36227A2D4EF">How do I debug queries?</a></li>
<li>  <a href="#reference_D5CE64F5FD6F4A808AEFB748C867189E__implicit_attributes">Can I use implicit attributes or methods in my query?</a></li>
<li>  <a href="#reference_D5CE64F5FD6F4A808AEFB748C867189E__section_ayq_hqw_1r">How do I perform a case-insensitive search on a field in OQL?</a></li>
</ul>

<h2 id="how-do-i-write-and-execute-a-query-against-a-geode-region?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_7A4D2C6A4E2C4F4384C158FFCA9CA1C0" class="no-quick-link"></a>How do I write and execute a query against a Geode region?</h2>

<p>To write and execute a query in Geode, you can use any of the following mechanisms. Sample query code follows.</p>

<ul>
<li>  Geode querying APIs</li>
<li>  <a href="../tools_modules/gfsh/chapter_overview.html">gfsh</a> command-line interface; in particular the <a href="../tools_modules/gfsh/command-pages/query.html">query</a> command</li>
<li>  REST API <a href="../rest_apps/rest_queries.html#concept_mmg_d35_m4">query endpoints</a></li>
</ul>

<p><strong>Sample Geode Query Code (Java)</strong></p>
<pre class="highlight plaintext"><code>// Identify your query string.
 String queryString = "SELECT * FROM /exampleRegion";

 // Get QueryService from Cache.
 QueryService queryService = cache.getQueryService();

 // Create the Query Object.
 Query query = queryService.newQuery(queryString);

 // Execute Query locally. Returns results set.
 SelectResults results = (SelectResults)query.execute();

 // Find the Size of the ResultSet.
 int size = results.size();

 // Iterate through your ResultSet.
 Portfolio p = (Portfolio)results.iterator().next(); /* Region containing Portfolio object. */
</code></pre>

<h2 id="can-i-see-query-string-examples,-listed-by-query-type?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_641D97CD874D4182961C85429ACA1B05" class="no-quick-link"></a>Can I see query string examples, listed by query type?</h2>

<p>The following example query strings use the <code>/exampleRegion</code> whose keys are the portfolio ID and whose values correspond to the summarized data shown in the following class definitions:</p>
<pre class="highlight plaintext"><code>class Portfolio implements DataSerializable {
   int ID;
   String type;
   String status;
   Map positions;
}
class Position implements DataSerializable {
   String secId;
   double mktValue;
   double qty;
}
</code></pre>

<p><strong>Basic WHERE Clause Examples</strong></p>

<p>In the following examples, the status field is type String and the ID field is type int. See <a href="../developing/query_additional/literals.html#literals">Supported Literals</a> for a complete list of literals supported in Geode querying.</p>

<ol>
<li><p>Select all active portfolios.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE status = 'active'
</code></pre></li>
<li><p>Select all portfolios whose status begins with &lsquo;activ&rsquo;.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion p WHERE p.status LIKE 'activ%'
</code></pre></li>
<li><p>Select all portfolios whose ID is greater than 100.</p>
<pre class="highlight plaintext"><code>SELECT * from /exampleRegion p WHERE p.ID &gt; 100
</code></pre></li>
</ol>

<p><strong>Using DISTINCT</strong></p>

<p>Select distinct Objects from the region that satisfy the where clause condition of status = &#39;active&rsquo;.</p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion WHERE status = 'active'
</code></pre>

<p><strong>Aliases and Synonyms</strong></p>

<p>In the query string, the path expressions (region and its objects) can be defined using an alias. This alias can be used or referred to in other places in the query.</p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p WHERE p.status = 'active'
</code></pre>
<pre class="highlight plaintext"><code>SELECT p.ID, p.status FROM /exampleRegion p WHERE p.ID &gt; 0
</code></pre>

<p><strong>Using the NOT Operator</strong></p>

<p>See <a href="../developing/query_additional/operators.html#operators">Operators</a> for a complete list of supported operators.</p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion WHERE NOT (status = 'active') AND ID = 2
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE NOT (ID IN SET(1,2))
</code></pre>

<p><strong>Using the AND and OR Operators</strong></p>

<p>See <a href="../developing/query_additional/operators.html#operators">Operators</a> for a complete list of supported operators.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE ID &gt; 4 AND ID &lt; 9
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE ID = 0 OR ID = 1
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT p.status FROM /exampleRegion p 
WHERE (p.createTime IN SET (10|) OR p.status IN SET ('active')) AND p.ID &gt; 0
</code></pre>

<p><strong>Using not equal to</strong></p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio WHERE portfolio.ID &lt;&gt; 2
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio WHERE portfolio.ID != 2
</code></pre>

<p><strong>Projection attribute example</strong></p>
<pre class="highlight plaintext"><code>SELECT p.get('account') FROM /exampleRegion p
</code></pre>

<p><strong>Querying nested collections</strong></p>

<p>The following query uses Positions of type HashMap.</p>
<pre class="highlight plaintext"><code>SELECT p, pos FROM /exampleRegion p, p.positions.values pos WHERE pos.secId = 'VMW'
</code></pre>

<p><strong>Using LIMIT</strong></p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion p WHERE p.ID &gt; 0 LIMIT 2
</code></pre>

<p><strong>Using COUNT</strong></p>

<p>See <a href="../developing/query_select/the_select_statement.html#concept_85AE7D6B1E2941ED8BD2A8310A81753E__section_B2CBA00EB83F463DAF4769D7859C64C8">COUNT</a> for more information.</p>
<pre class="highlight plaintext"><code>SELECT COUNT(*) FROM /exampleRegion WHERE ID &gt; 0
</code></pre>
<pre class="highlight plaintext"><code>SELECT COUNT(*) FROM /exampleRegion WHERE ID &gt; 0 LIMIT 50
</code></pre>
<pre class="highlight plaintext"><code>SELECT COUNT(*) FROM /exampleRegion WHERE ID &gt; 0 AND status LIKE 'act%'
</code></pre>
<pre class="highlight plaintext"><code>SELECT COUNT(*) FROM /exampleRegion WHERE ID IN SET(1,2,3,4,5)
</code></pre>
<pre class="highlight plaintext"><code>SELECT COUNT(*) FROM /exampleRegion p, p.positions.values pos 
WHERE p.ID &gt; 0 AND pos.secId 'IBM'
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT COUNT(*) FROM /exampleRegion p, p.positions.values pos
WHERE p.ID &gt; 0 OR p.status = 'active' OR pos.secId OR pos.secId = 'IBM'
</code></pre>

<p><strong>Using LIKE</strong></p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion ps WHERE ps.pkid LIKE '_bc'
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion ps WHERE ps.status LIKE '_b_' OR ps.pkid = '2'
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion ps WHERE ps.status LIKE '%b%
</code></pre>

<p><strong>Using Region Entry Keys and Values</strong></p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion.keys k WHERE k.ID = 1
</code></pre>
<pre class="highlight plaintext"><code>SELECT entry.value FROM /exampleRegion.entries entry WHERE entry.key = '1'
</code></pre>
<pre class="highlight plaintext"><code>SELECT key, positions FROM /exampleRegion.entrySet, value.positions.values positions 
WHERE positions.mktValue &gt;= 25.00
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT entry.value FROM /exampleRegion.entries entry WHERE entry.key = '1'
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion.entries entry WHERE entry.value.ID &gt; 1
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion.keySet key WHERE key = '1'
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion.values portfolio 
WHERE portfolio.status = 'active'
</code></pre>

<p><strong>Nested Queries</strong></p>
<pre class="highlight plaintext"><code>IMPORT "query".Portfolio;
SELECT * FROM /exampleRegion, (SELECT DISTINCT * FROM /exampleRegion p TYPE Portfolio, p.positions 
WHERE value!=null)
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM (SELECT DISTINCT * FROM /exampleRegion portfolios, positions pos) 
WHERE pos.value.secId = 'IBM'
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio 
WHERE portfolio.ID IN (SELECT p2.ID FROM /exampleRegion2 p2 WHERE p2.ID &gt; 1)
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p, (SELECT DISTINCT pos 
FROM /exampleRegion x, x.positions.values pos WHERE x.ID = p.ID ) AS itrX
</code></pre>

<p><strong>Query the results of a FROM clause expression</strong></p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM (SELECT DISTINCT * FROM /Portfolios ptf, positions pos) p 
WHERE p.get('pos').value.secId = 'IBM'
</code></pre>

<p><strong>Hash Map Query</strong></p>

<p>Query using a hashmap. In the following examples, &#39;version&rsquo; is one of the keys in the hashmap.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion p WHERE p['version'] = '1.0'
</code></pre>
<pre class="highlight plaintext"><code>SELECT entry.key, entry.value FROM /exampleRegion.entries entry 
WHERE entry.value['version'] = '100'
</code></pre>

<p><strong>Map example where &ldquo;map&rdquo; is a nested HashMap object</strong></p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p WHERE p.portfolios['key2'] &gt;= 3
</code></pre>

<p><strong>Example Queries that Fetch Array Values</strong></p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion p WHERE p.names[0] = 'aaa'
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion p WHERE p.collectionHolderMap.get('1').arr[0] = '0'
</code></pre>

<p><strong>Using ORDER BY (and ORDER BY with LIMIT)</strong></p>

<p>You must use the DISTINCT keyword with ORDER BY queries.</p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion WHERE ID &lt; 101 ORDER BY ID
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion WHERE ID &lt; 101 ORDER BY ID asc
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion WHERE ID &lt; 101 ORDER BY ID desc
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT key.ID, key.status AS st FROM /exampleRegion.keys key 
WHERE key.status = 'inactive' ORDER BY key.status desc, key.ID LIMIT 1
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p ORDER BY p.getP1().secId, p.ID dec, p.ID LIMIT 9
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p ORDER BY p.ID, val.secId LIMIT 1
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT e.key FROM /exampleRegion.entrySet e ORDER BY e.key.ID desc, e.key.pkid desc
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT p.names[1] FROM /exampleRegion p ORDER BY p.names[1]
</code></pre>

<p><strong>Join Queries</strong></p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio1, /exampleRegion2 portfolio2 
WHERE portfolio1.status = portfolio2.status
</code></pre>
<pre class="highlight plaintext"><code>SELECT portfolio1.ID, portfolio2.status FROM /exampleRegion portfolio1, /exampleRegion2 portfolio2 
WHERE portfolio1.status = portfolio2.status
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio1, portfolio1.positions.values positions1, 
/exampleRegion2 portfolio2, portfolio2.positions.values positions2 WHERE positions1.secId = positions1.secId
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio1, portfolio1.positions.values positions1, 
/exampleRegion2 portfolio2, portfolio2.positions.values positions2 WHERE portfolio1.ID = 1 
AND positions1.secId = positions1.secId
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT a, b.price FROM /exampleRegoin1 a, /exampleRegion2 b WHERE a.price = b.price
</code></pre>

<p><strong>Using AS</strong></p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion p, p.positions.values AS pos WHERE pos.secId != '1'
</code></pre>

<p><strong>Using TRUE</strong></p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /Portfolios WHERE TRUE
</code></pre>

<p><strong>Using IN and SET</strong></p>

<p>See also <a href="../developing/query_select/the_where_clause.html#the_where_clause__section_AC12146509F141378E493078540950C7">IN and SET</a>.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio WHERE portfolio.ID IN SET(1, 2)
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio, portfolio.positions.values positions 
WHERE portfolio.Pk IN SET ('1', '2') AND positions.secId = '1'
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio, portfolio.positions.values positions 
WHERE portfolio.Pk IN SET ('1', '2') OR positions.secId IN SET ('1', '2', '3')
</code></pre>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion portfolio, portfolio.positions.values positions 
WHERE portfolio.Pk IN SET ('1', '2') OR positions.secId IN SET ('1', '2', '3') 
AND portfolio.status = 'active'
</code></pre>

<p><strong>Querying for Set values</strong></p>

<p>In the following query, sp is of type Set.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE sp = set('20', '21', '22')
</code></pre>

<p>If the Set (sp) only contains &#39;20&rsquo; and &#39;21&rsquo;, then the query will evaluate to false. The query compares the two sets and looks for the presence of elements in both sets.</p>

<p>For other collection types like list (sp is of type List), the query can be written as follows:</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE sp.containsAll(set('20', '21', '22'))
</code></pre>

<p><strong>Invoking Methods on Objects</strong></p>

<p>See <a href="../developing/query_select/the_where_clause.html#the_where_clause__section_D2F8D17B52B04895B672E2FCD675A676">Method Invocations</a> for more information.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion p WHERE p.length &gt; 1
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p WHERE p.positions.size &gt;= 2
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p WHERE p.positions.isEmpty
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion p WHERE p.name.startsWith('Bo')
</code></pre>

<p><strong>Using Query-Level Debugging</strong></p>

<p>To set debugging on the query level, add the <strong>&lt;trace&gt;</strong> keyword before the query. (If you are using an IMPORT statement, include it before the IMPORT).</p>
<pre class="highlight plaintext"><code>&lt;trace&gt;
SELECT * from /exampleRegion, positions.values TYPE myclass
</code></pre>

<p><strong>Using Reserved Words in Queries</strong></p>

<p>To access any method, attribute, or named object that has the same name as a query language reserved word, enclose the name within double quotation marks.</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE status = 'active' AND "type" = 'XYZ'
</code></pre>
<pre class="highlight plaintext"><code>SELECT DISTINCT "type" FROM /exampleRegion WHERE status = 'active'
</code></pre>

<p><strong>Using IMPORT</strong></p>

<p>In the case where the same class name resides in two different namescopes (packages), there needs to be a means of referring to different classes of the same name. The IMPORT statement is used to establish a namescope for a class in a query.</p>
<pre class="highlight plaintext"><code>IMPORT package.Position;
SELECT DISTINCT * FROM /exampleRegion, positions.values positions TYPE Position WHERE positions.mktValue &gt;= 25.00
</code></pre>

<p><strong>Using TYPE</strong></p>

<p>Specifying object type helps the query engine to process the query at optimal speed. Apart from specifying the object types during configuration (using key-constraint and value-constraint), type can be explicitly specified in the query string.</p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion, positions.values positions TYPE Position WHERE positions.mktValue &gt;= 25.00
</code></pre>

<p><strong>Using ELEMENT</strong></p>

<p>Using ELEMENT(expr) extracts a single element from a collection or array. This function throws a <code>FunctionDomainException</code> if the argument is not a collection or array with exactly one element.</p>
<pre class="highlight plaintext"><code>ELEMENT(SELECT DISTINCT * FROM /exampleRegion WHERE id = 'XYZ-1').status = 'active'
</code></pre>

<h2 id="which-apis-should-i-use-to-write-my-queries?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_5383407F9D004D4EB4E695252EBA1EF0" class="no-quick-link"></a>Which APIs should I use to write my queries?</h2>

<p>If you are querying a Java application’s local cache or querying other members, use <a href="/releases/latest/javadoc/org/apache/geode/cache/query/QueryService.html">org.apache.geode.cache.Cache.getQueryService</a>.</p>

<p>If you are writing a Java client to server query, use <a href="/releases/latest/javadoc/org/apache/geode/cache/client/Pool.html">org.apache.geode.cache.client.Pool.getQueryService</a>.</p>

<h2 id="how-do-i-invoke-an-object&#39;s-method-in-a-query?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_3E6E4B33D57846008EF4404D2B687597" class="no-quick-link"></a>How do I invoke an object&rsquo;s method in a query?</h2>

<p>To use a method in a query, use the attribute name that maps to the public method you want to invoke. For example:</p>
<pre class="highlight plaintext"><code>/*valid method invocation*/ 
SELECT DISTINCT * FROM /exampleRegion p WHERE p.positions.size &gt;= 2 - maps to positions.size()
</code></pre>

<h2 id="can-i-invoke-a-static-method-on-an-object-in-a-query?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_9221C29BC1FD49D7BBD26BB34D5BDEB8" class="no-quick-link"></a>Can I invoke a static method on an object in a query?</h2>

<p>No, you cannot invoke a static method on an object. For example, the following query is invalid.</p>
<pre class="highlight plaintext"><code>/*invalid method invocation*/
SELECT DISTINCT * FROM /exampleRegion WHERE aDay = Day.Wednesday
</code></pre>

<p>To work around this limitation, write a reusable query that uses a query bind parameter to invoke the static method. Then at query run time, set the parameter to the static method invocation (<code>Day.Wednesday</code>). For example:</p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion WHERE aDay = $1
</code></pre>

<h2 id="how-do-i-write-a-reusable-query?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_907DBBBA1AEC4570A15B3491B0A7DF0E" class="no-quick-link"></a>How do I write a reusable query?</h2>

<p>Using query APIs, you can set query bind parameters that are passed values at query run time. For example:</p>
<pre class="highlight plaintext"><code>// specify the  query string
 String queryString = "SELECT DISTINCT * FROM /exampleRegion p WHERE p.status = $1";

QueryService queryService = cache.getQueryService();
Query query = queryService.newQuery(queryString);

// set a query bind parameter
Object[] params = new Object[1];
params[0] = "active";

// Execute the query locally. It returns the results set.
SelectResults results = (SelectResults) query.execute(params);

// use the results of the query; this example only looks at the size
 int size = results.size();
</code></pre>

<p>If you use a query bind parameter in place of a region path in your path expression, the parameter value must reference a collection (and not a String such as the name of the region path.)</p>

<p>See <a href="../developing/query_additional/using_query_bind_parameters.html#concept_173E775FE46B47DF9D7D1E40680D34DF">Using Query Bind Parameters</a> for more details.</p>

<h2 id="when-should-i-create-indexes-to-use-in-my-queries?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_3A9528E8E43140BAA0D5A1457CCAB2D2" class="no-quick-link"></a>When should I create indexes to use in my queries?</h2>

<p>Determine whether your query’s performance will benefit from an index. For example, in the following query, an index on pkid can speed up the query.</p>
<pre class="highlight plaintext"><code>SELECT DISTINCT * FROM /exampleRegion portfolio WHERE portfolio.pkid = '123'
</code></pre>

<h2 id="how-do-i-create-an-index?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_76CDCCFBDB134A339DBE556C28D48F11" class="no-quick-link"></a>How do I create an index?</h2>

<p>An index can be created programmatically using APIs or by using xml. Here are two examples:</p>

<p><strong>Sample Code</strong></p>
<pre class="highlight plaintext"><code>QueryService qs = cache.getQueryService();
 qs.createIndex("myIndex", "status", "/exampleRegion");
 qs.createKeyIndex("myKeyIndex", "id", "exampleRegion");
</code></pre>

<p>For more information on using this API, see the <a href="/releases/latest/javadoc/index.html">JavaDocs</a>.</p>

<p><strong>Sample XML</strong></p>
<pre class="highlight plaintext"><code>&lt;region name="portfolios"&gt;
 &lt;region-attributes . . . &gt;
 &lt;/region-attributes&gt;
 &lt;index name="myIndex"&gt;
 &lt;functional from-clause="/exampleRegion" 
     expression="status"/&gt;
 &lt;/index&gt;
 &lt;index name="myKeyIndex"&gt;
 &lt;primary-key field="id"/&gt;
 &lt;/index&gt;
 &lt;entry&gt;
</code></pre>

<p>For more details on indexes, see <a href="../developing/query_index/query_index.html">Working with Indexes</a>.</p>

<h2 id="can-i-create-indexes-on-overflow-regions?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_30D8C9A5472E4768AB7A0D598C9A496E" class="no-quick-link"></a>Can I create indexes on overflow regions?</h2>

<p>You can create indexes on overflow regions, but you are subject to some limitations. For example, the data contained in the index itself cannot be overflowed to disk. See <a href="../developing/query_index/indexes_with_overflow_regions.html#concept_87BE7DB32C714EB0BF7532AF93569328">Using Indexes with Overflow Regions</a> for more information.</p>

<h2 id="can-i-query-a-partitioned-region?-can-i-perform-a-join-query-on-a-partitioned-region?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_EDD17817450C4FC0B510CD87DB2FCD16" class="no-quick-link"></a>Can I query a partitioned region? Can I perform a join query on a partitioned region?</h2>

<p>You can query partitioned regions, but there are some limitations. You cannot perform join queries on partitioned regions, however you can perform equi-join queries on colocated partitioned regions by executing a function on a local data set.</p>

<p>For a full list of restrictions, see <a href="../developing/query_additional/partitioned_region_query_restrictions.html#concept_5353476380D44CC1A7F586E5AE1CE7E8">Partitioned Region Query Restrictions</a>.</p>

<h2 id="how-can-i-improve-the-performance-of-a-partitioned-region-query?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_5FF905E0D10D4CDF9E6F49A70848AF69" class="no-quick-link"></a>How can I improve the performance of a partitioned region query?</h2>

<p>If you know the data you need to query, you can target particular nodes in your queries (thus reducing the number of servers the query needs to access) by executing the query with the FunctionService. See <a href="../developing/query_additional/query_on_a_single_node.html#concept_30B18A6507534993BD55C2C9E0544A97">Querying a Partitioned Region on a Single Node</a> for details. If you are querying data that has been partitioned by a key or specific field, you should first create a key index and then execute the query using the FunctionService with the key or field as a filter. See <a href="../developing/query_additional/partitioned_region_key_or_field_value.html#concept_3010014DFBC9479783B2B45982014454">Optimizing Queries on Data Partitioned by a Key or Field Value</a>.</p>

<h2 id="which-query-language-elements-are-supported-in-geode?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_FBC59A5420FD40D6907A302A1D50DF7E" class="no-quick-link"></a>Which query language elements are supported in Geode?</h2>

<table><thead>
<tr>
<th>Supported elements</th>
<th></th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>AND</td>
<td>LIMIT</td>
<td>TO_DATE</td>
</tr>
<tr>
<td>AS</td>
<td>LIKE</td>
<td>TYPE</td>
</tr>
<tr>
<td>COUNT</td>
<td>NOT</td>
<td>WHERE</td>
</tr>
<tr>
<td>DISTINCT</td>
<td>NVL</td>
<td></td>
</tr>
<tr>
<td>ELEMENT</td>
<td>OR</td>
<td></td>
</tr>
<tr>
<td>FROM</td>
<td>ORDER BY</td>
<td></td>
</tr>
<tr>
<td>&lt;HINT&gt;</td>
<td>SELECT</td>
<td></td>
</tr>
<tr>
<td>IMPORT</td>
<td>SET</td>
<td></td>
</tr>
<tr>
<td>IN</td>
<td>&lt;TRACE&gt;</td>
<td></td>
</tr>
<tr>
<td>IS_DEFINED</td>
<td>TRUE</td>
<td></td>
</tr>
<tr>
<td>IS_UNDEFINED</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<p>For more information and examples on using each supported keyword, see <a href="../developing/query_additional/supported_keywords.html#reference_07214B0F8DC94659B0F2D68B67195BD8">Supported Keywords</a>.</p>

<h2 id="how-do-i-debug-queries?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_314B88A55B514B88A12DC36227A2D4EF" class="no-quick-link"></a>How do I debug queries?</h2>

<p>You can debug a specific query at the query level by adding the &lt;trace&gt; keyword before the query string that you want to debug. Here is an example:</p>
<pre class="highlight plaintext"><code>&lt;trace&gt; SELECT * FROM /exampleRegion
</code></pre>

<p>You can also write:</p>
<pre class="highlight plaintext"><code>&lt;TRACE&gt; SELECT * FROM /exampleRegion
</code></pre>

<p>When the query is executed, Geode will log a message in <code>$GEMFIRE_DIR/system.log</code> with the following information:</p>
<pre class="highlight plaintext"><code>[info 2011/08/29 11:24:35.472 PDT CqServer &lt;main&gt; tid=0x1] Query Executed in 9.619656 ms; rowCount = 99; 
indexesUsed(0) "select *  from /exampleRegion" 
</code></pre>

<p>If you want to enable debugging for all queries, you can enable query execution logging by setting a System property on the command line during start-up:</p>
<pre class="highlight plaintext"><code>gfsh&gt;start server --name=server_name -–J=-Dgemfire.Query.VERBOSE=true
</code></pre>

<p>Or you can set the property programmatically:</p>
<pre class="highlight plaintext"><code>System.setProperty("gemfire.Query.VERBOSE","true");
</code></pre>

<h2 id="can-i-use-implicit-attributes-or-methods-in-my-query?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__implicit_attributes" class="no-quick-link"></a>Can I use implicit attributes or methods in my query?</h2>

<p>If an implicit attribute or method name can only be associated with one untyped iterator, the Geode query processor will assume that it is associated with that iterator. However, if more than one untyped iterator is in scope, then the query will fail with a <code>TypeMismatchException</code>. The following query fails because the query processor does not fully type expressions:</p>
<pre class="highlight plaintext"><code>select distinct value.secId from /pos , getPositions(23)
</code></pre>

<p>The following query, however, succeeds because the iterator is either explicitly named with a variable or it is typed:</p>
<pre class="highlight plaintext"><code>select distinct e.value.secId from /pos , getPositions(23) e

</code></pre>

<h2 id="can-i-instruct-the-query-engine-to-use-specific-indexes-with-my-queries?">Can I instruct the query engine to use specific indexes with my queries?</h2>

<p>Using HINT <em>indexname</em> allows you to instruct the query engine to prefer and filter results from the specified indexes. If you provide multiple index names, the query engine will use all available indexes but prefer the specified indexes.</p>
<pre class="highlight plaintext"><code>&lt;HINT 'IDIndex'&gt; SELECT * FROM /Portfolios p WHERE p.ID &gt; 10 AND p.owner = 'XYZ'
</code></pre>
<pre class="highlight plaintext"><code>&lt;HINT 'IDIndex', 'OwnerIndex'&gt; SELECT * FROM /Portfolios p WHERE p.ID &gt; 10 AND p.owner = 'XYZ' AND p.value &lt; 100

</code></pre>

<h2 id="how-do-i-perform-a-case-insensitive-search-on-a-field-in-oql?"><a id="reference_D5CE64F5FD6F4A808AEFB748C867189E__section_ayq_hqw_1r" class="no-quick-link"></a>How do I perform a case-insensitive search on a field in OQL?</h2>

<p>You can use the Java String class methods <code>toUpperCase</code> and <code>toLowerCase</code> to transform fields where you want to perform a case-insensitive search. For example:</p>
<pre class="highlight plaintext"><code>SELECT entry.value FROM /exampleRegion.entries entry WHERE entry.value.toUpperCase LIKE '%BAR%'
</code></pre>

<p>or</p>
<pre class="highlight plaintext"><code>SELECT * FROM /exampleRegion WHERE foo.toLowerCase LIKE '%bar%'
</code></pre>

        <!-- 
 -->
      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <!--  -->
  </footer>
</div><!--end of container-->

</body>
</html>
